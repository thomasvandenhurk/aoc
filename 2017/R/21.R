srcfile <- system.file("samples", "bootlmEx.R", package = "proftools")
pd <- profileExpr(source(srcfile))

art=c("	../.. => .../.../###	",
"	#./.. => .../.#./.##	",
"	##/.. => .#./.#./...	",
"	.#/#. => ###/..#/.##	",
"	##/#. => ..#/###/#..	",
"	##/## => ..#/#../##.	",
"	.../.../... => .##./##../..##/.##.	",
"	#../.../... => ##../.#.#/..#./###.	",
"	.#./.../... => ##.#/#.#./.#../..##	",
"	##./.../... => ...#/##.#/.#.#/#.##	",
"	#.#/.../... => ..#./#.../###./...#	",
"	###/.../... => #.#./...#/#.#./###.	",
"	.#./#../... => ...#/###./.##./...#	",
"	##./#../... => ###./####/###./..##	",
"	..#/#../... => ####/#.../####/#.##	",
"	#.#/#../... => #.##/.#.#/##.#/###.	",
"	.##/#../... => ..../.#../.#.#/.##.	",
"	###/#../... => ..##/##.#/..##/.###	",
"	.../.#./... => ###./..##/.#../#..#	",
"	#../.#./... => ###./.#../#.../#...	",
"	.#./.#./... => ####/..#./.##./##..	",
"	##./.#./... => .#../#.#./###./###.	",
"	#.#/.#./... => ####/.##./##.#/.###	",
"	###/.#./... => #.#./..##/.##./#...	",
"	.#./##./... => ####/#.##/####/..#.	",
"	##./##./... => #.../.#../..../#.##	",
"	..#/##./... => #..#/..##/#.../####	",
"	#.#/##./... => ###./##../..##/#...	",
"	.##/##./... => ..../#.##/.###/#.#.	",
"	###/##./... => .#../##.#/.#../##..	",
"	.../#.#/... => ...#/.###/.##./###.	",
"	#../#.#/... => ###./##../#.#./.##.	",
"	.#./#.#/... => ..#./.#../.##./.###	",
"	##./#.#/... => #.../#.../.##./.#..	",
"	#.#/#.#/... => .##./..##/.###/#...	",
"	###/#.#/... => ..../####/###./....	",
"	.../###/... => #.##/.#.#/#.##/...#	",
"	#../###/... => #.../#.#./.#../#...	",
"	.#./###/... => ...#/###./.##./.#.#	",
"	##./###/... => ##../####/###./#.##	",
"	#.#/###/... => ...#/###./##.#/.#.#	",
"	###/###/... => #.#./##.#/..../.##.	",
"	..#/.../#.. => ...#/..#./..#./##..	",
"	#.#/.../#.. => ..#./#.##/#.#./#.##	",
"	.##/.../#.. => ####/####/#.##/#...	",
"	###/.../#.. => ###./..#./###./.#..	",
"	.##/#../#.. => ...#/####/..../###.	",
"	###/#../#.. => ##.#/.#../##.#/...#	",
"	..#/.#./#.. => ###./#.##/...#/##..	",
"	#.#/.#./#.. => #.../..#./..#./#.##	",
"	.##/.#./#.. => ##.#/...#/#.#./.###	",
"	###/.#./#.. => .#../..##/#.#./..#.	",
"	.##/##./#.. => #.../#.#./.###/#...	",
"	###/##./#.. => .##./.#../.#.#/.###	",
"	#../..#/#.. => ###./#..#/#.../##.#	",
"	.#./..#/#.. => #.#./#..#/#.../.###	",
"	##./..#/#.. => ...#/..##/..#./####	",
"	#.#/..#/#.. => ####/#..#/###./#.#.	",
"	.##/..#/#.. => ..#./..#./..../.##.	",
"	###/..#/#.. => ...#/#..#/#.#./....	",
"	#../#.#/#.. => ..##/.#.#/.###/.##.	",
"	.#./#.#/#.. => ..../##.#/..##/#..#	",
"	##./#.#/#.. => ..#./..##/#..#/#..#	",
"	..#/#.#/#.. => ..#./#.../#.#./##..	",
"	#.#/#.#/#.. => ##.#/..##/.###/...#	",
"	.##/#.#/#.. => #.##/.##./##../#.#.	",
"	###/#.#/#.. => ####/##.#/#..#/#.#.	",
"	#../.##/#.. => ..##/#.#./####/####	",
"	.#./.##/#.. => ##../###./####/....	",
"	##./.##/#.. => .###/####/..#./...#	",
"	#.#/.##/#.. => ###./##../##../#.##	",
"	.##/.##/#.. => ##../.###/####/.#.#	",
"	###/.##/#.. => ##../.##./#.../..#.	",
"	#../###/#.. => #.#./.#.#/#.../....	",
"	.#./###/#.. => .##./##../...#/##..	",
"	##./###/#.. => #.#./..../.##./##.#	",
"	..#/###/#.. => ...#/...#/##.#/...#	",
"	#.#/###/#.. => .##./.###/#..#/.##.	",
"	.##/###/#.. => ####/..##/#.../####	",
"	###/###/#.. => ...#/####/..#./.###	",
"	.#./#.#/.#. => .##./#.##/.##./.###	",
"	##./#.#/.#. => ..##/.#../##.#/###.	",
"	#.#/#.#/.#. => .#../..../.#.#/#...	",
"	###/#.#/.#. => ###./..#./..../#.#.	",
"	.#./###/.#. => #..#/.#../#.../..##	",
"	##./###/.#. => .##./...#/.###/....	",
"	#.#/###/.#. => .###/###./#.#./.#.#	",
"	###/###/.#. => #.##/.#.#/#.#./.##.	",
"	#.#/..#/##. => .###/..../####/####	",
"	###/..#/##. => #.##/###./..##/.##.	",
"	.##/#.#/##. => ..../...#/#..#/..##	",
"	###/#.#/##. => #.##/.#../.#../....	",
"	#.#/.##/##. => ..##/..##/#.../#..#	",
"	###/.##/##. => ##.#/#.../#.##/..##	",
"	.##/###/##. => ...#/..#./##../#.##	",
"	###/###/##. => #.##/#..#/..#./...#	",
"	#.#/.../#.# => ##.#/.#../##.#/.##.	",
"	###/.../#.# => #.#./..##/.#.#/##.#	",
"	###/#../#.# => ..#./#.##/...#/.###	",
"	#.#/.#./#.# => .###/#.##/#..#/#.##	",
"	###/.#./#.# => ..../..#./###./..#.	",
"	###/##./#.# => .###/##../..##/####	",
"	#.#/#.#/#.# => #.#./####/.#../.##.	",
"	###/#.#/#.# => ####/..../..##/#...	",
"	#.#/###/#.# => #.../.##./#.../...#	",
"	###/###/#.# => .#.#/...#/..../..##	",
"	###/#.#/### => .#../#.##/#.##/.###	",
"	###/###/### => #.../.#.#/#..#/#.##	")

artrules2 <- NULL
for (i in 1:6){
 art[i] <- gsub("\t","",art[i])
 art[i] <- gsub("#","1",art[i])
 art[i] <- gsub("\\.","0",art[i])
 art[i] <- gsub("/","",art[i])
 artrules2[i] <- strsplit(art[i]," => ")
}

artrules3 <- NULL
for (i in 7:length(art)){
  art[i] <- gsub("\t","",art[i])
  art[i] <- gsub("#","1",art[i])
  art[i] <- gsub("\\.","0",art[i])
  art[i] <- gsub("/","",art[i])
  artrules3[i-6] <- strsplit(art[i]," => ")
}


rotate <- function(x) t(apply(x,2,rev))
flip <- function(x) apply(t(x),1,rev)

find_all_pos <- function(x, colnr){
  x<-matrix(x, ncol = colnr)
  fx <- flip(x)
  pos <- rbind(as.vector(x),as.vector(rotate(x)),as.vector(rotate(rotate(x))),as.vector(rotate(rotate(rotate(x)))),as.vector(fx),as.vector(rotate(fx)),as.vector(rotate(rotate(fx))),as.vector(rotate(rotate(rotate(fx)))))
  pos <- pos[!duplicated(pos),]
  pos
}

change_pos <- function(x, colnr){
  x <- as.vector(t(matrix(as.numeric(strsplit(x,"")[[1]]),ncol=colnr)))
  x
}

artrules22 <- NULL
artrules22sol <- NULL
for (i in 1:length(artrules2)){
  cursol <- find_all_pos(change_pos(artrules2[[i]][1],2),2)
  if(is.matrix(cursol)){
  artrules22sol<-rbind(artrules22sol,t(replicate(nrow(cursol),change_pos(artrules2[[i]][2],3))))
  }
  else{
    artrules22sol<-rbind(artrules22sol,change_pos(artrules2[[i]][2],3))
  }
  artrules22<-rbind(artrules22,cursol)
}
rownames(artrules22) <- NULL

artrules33 <- NULL
artrules33sol <- NULL
for (i in 1:length(artrules3)){
  cursol <- find_all_pos(change_pos(artrules3[[i]][1],3),3)
  if(is.matrix(cursol)){
    artrules33sol<-rbind(artrules33sol,t(replicate(nrow(cursol),change_pos(artrules3[[i]][2],4))))
  }
  else{
    artrules33sol<-rbind(artrules33sol,change_pos(artrules3[[i]][2],4))
  }
  artrules33<-rbind(artrules33,cursol)
}
rownames(artrules33) <- NULL


start <- c(0,0,1,1,0,1,0,1,1)

for(turn in 1:18){
  print(turn)
  submat <- NULL
  
  if((sqrt(length(start))%%2)==0){
    colnr <- sqrt(length(start))/2
    for (i in 1:colnr){
      for (j in 1:colnr){
        submat <- rbind(submat,as.vector(t(matrix(start,ncol = sqrt(length(start)))[(1+(i-1)*2):(2+(i-1)*2),(1+(j-1)*2):(2+(j-1)*2)])))
      }
    }
    
    if(is.matrix(submat)){
      lencol <- ncol(submat)
    } else {
      lencol <- length(submat)
    }
    
    temp <- NULL
    for (i in 1:nrow(submat)){
      found <- FALSE
      j<-1
      while (!found){
        if(sum(artrules22[j,]==submat[i,])==lencol){
          found <- TRUE
        } else {
          j <- j + 1
        }
      }
      temp <- c(temp,j)
    } 
    submat <- artrules22sol[temp,]
  } else if((sqrt(length(start))%%3)==0){
    colnr <- sqrt(length(start))/3
    for (i in 1:colnr){
      for (j in 1:colnr){
        submat <- rbind(submat,as.vector(t(matrix(start,ncol = sqrt(length(start)))[(1+(i-1)*3):(3+(i-1)*3),(1+(j-1)*3):(3+(j-1)*3)])))
      }
    }
    
    if(is.matrix(submat)){
      lencol <- ncol(submat)
    } else {
      lencol <- length(submat)
    }
    
    temp <- NULL
    for (i in 1:nrow(submat)){
      found <- FALSE
      j<-1
      while (!found){
        if(sum(artrules33[j,]==submat[i,])==lencol){
          found <- TRUE
        } else {
          j <- j + 1
        }
      }
      temp <- c(temp,j)
    } 
    submat <- artrules33sol[temp,]
  }
  
  if(is.matrix(submat)){
    start <- matrix(rep(0,nrow(submat)*ncol(submat)), ncol = sqrt(ncol(submat)*nrow(submat)))
    lencol <- sqrt(ncol(submat))
    lenrow <- sqrt(nrow(submat))
    
    count <- 1
    for (i in 1:lenrow){
      for (j in 1:lenrow){
        start[(1+(i-1)*lencol):(lencol+(i-1)*lencol),(1+(j-1)*lencol):(lencol+(j-1)*lencol)] <- t(matrix(submat[count,], ncol = lencol))
        count <- count + 1
      }
    }
    
  } else {
    start <- matrix(submat, ncol = sqrt(length(submat)), byrow = TRUE)
  }
  
  start <- as.vector(start)
}



